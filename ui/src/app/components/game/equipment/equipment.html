<div class="equipment-container">
  <h2 class="equipment-title">Equipment</h2>

  <div class="equipment-grid">
    @for (slot of slotConfigs; track slot.name) {
      <div
        class="equipment-slot"
        [class.drag-over]="isSlotDraggedOver(slot.name)"
        [class.occupied]="getItemInSlot(slot.name)"
        [style.grid-row]="slot.position.row"
        [style.grid-column]="slot.position.col"
        (dragover)="onDragOver($event, slot.name)"
        (dragleave)="onDragLeave()"
        (drop)="onDrop($event, slot.name)"
        (contextmenu)="onSlotContextMenu($event, slot.name)"
        [title]="slot.label">

        <!-- Empty slot -->
        @if (!getItemInSlot(slot.name)) {
          <div class="slot-empty">
            <img [src]="slot.icon" [alt]="slot.label" class="slot-icon" />
            <span class="slot-label">{{ slot.label }}</span>
          </div>
        }

        <!-- Equipped item -->
        @if (getItemInSlot(slot.name); as item) {
          <div
            class="slot-item"
            [class]="getRarityClass(item.definition.rarity)"
            (click)="onItemClick(slot.name)">
            @if (item.definition.icon) {
              <app-icon [icon]="item.definition.icon" [autoSize]="true" class="item-icon"></app-icon>
            } @else {
              <img [src]="slot.icon" [alt]="slot.label" class="item-icon" />
            }
            <div class="item-info">
              <div class="item-name">{{ item.definition.name }}</div>
              @if (item.definition.properties['defense']) {
                <div class="item-stat">üõ°Ô∏è {{ item.definition.properties['defense'] }}</div>
              }
            </div>
            <div class="item-rarity-badge">{{ item.definition.rarity }}</div>
          </div>
        }
      </div>
    }
  </div>

  <div class="equipment-help">
    <p><strong>Drag & Drop</strong> equipment from inventory to equip</p>
    <p><strong>Right-click</strong> equipped items to unequip</p>
    <p><strong>Left-click</strong> equipped items to view details</p>
  </div>

  <!-- Item Details Panel (Shared Component) -->
  <app-item-details-panel
    *ngIf="selectedItem"
    [item]="selectedItem"
    [showActions]="true"
    [showDropControls]="false"
    (close)="closeItemDetails()"
    (equipItem)="equipItem($event)"
    (unequipItem)="unequipItem($event)"
    (useItem)="useItem($event)"
    (removeItem)="removeItem($event.instanceId)"
    (removeAllItems)="removeAllItems($event)">
  </app-item-details-panel>
</div>
