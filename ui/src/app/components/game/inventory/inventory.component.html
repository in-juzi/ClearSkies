<div class="inventory-container">
  <!-- Header -->
  <div class="inventory-header">
    <h2 class="text-2xl font-bold text-gold-400">Inventory</h2>
    <div class="alt-hint" *ngIf="isAltKeyHeld">
      <span class="hint-icon">‚ö°</span>
      <span class="hint-text">{{ vendorService.isVendorOpen() ? 'Quick Sell Mode' : 'Quick Drop Mode' }}</span>
    </div>
  </div>

  <!-- Category Filter -->
  <div class="category-filter">
    <button
      *ngFor="let category of categories"
      [class.active]="selectedCategory === category.value"
      (click)="selectedCategory = category.value"
      class="category-btn">
      {{ category.shortLabel }}
    </button>
  </div>

  <!-- Inventory Grid -->
  <div class="inventory-grid">
    <div
      *ngFor="let item of getFilteredInventory()"
      class="inventory-item"
      [class]="getRarityClass(item.definition.rarity)"
      [class.equipped]="item.equipped"
      [class.alt-sell-mode]="isAltKeyHeld && vendorService.isVendorOpen()"
      [class.alt-drop-mode]="isAltKeyHeld && !vendorService.isVendorOpen()"
      [draggable]="true"
      (click)="onItemClick($event, item)"
      (contextmenu)="onItemRightClick($event, item)"
      (dragstart)="onItemDragStart($event, item)"
      (dragend)="onItemDragEnd($event)"
      [title]="getItemTooltip(item)">
      <!-- Item icon (left side) -->
      <div class="item-icon">
        <app-icon
          *ngIf="item.definition.icon"
          [icon]="item.definition.icon"
          [size]="40"
          [alt]="item.definition.name">
        </app-icon>
        <span *ngIf="!item.definition.icon" class="item-tier">T{{ item.definition.properties.tier }}</span>
      </div>

      <!-- Item content (right side - vertical stack) -->
      <div class="item-content">
        <!-- Top row: Name + Quantity -->
        <div class="item-header">
          <div class="item-name" [class]="inventoryService.getRarityColor(item.definition.rarity)">
            {{ item.definition.name }}
          </div>
          <div class="item-quantity" *ngIf="item.quantity > 1">x{{ item.quantity }}</div>
        </div>

        <!-- Bottom row: Quality/Trait badges -->
        <div class="item-badges">
          <app-item-modifiers [item]="item" displayMode="badge-level" size="normal"></app-item-modifiers>
        </div>
      </div>
    </div>

    <!-- Empty slots -->
    <div *ngIf="getFilteredInventory().length === 0" class="empty-message">
      <p>No items in this category</p>
    </div>
  </div>

  <!-- Item Details Panel (Shared Component) -->
  <app-item-details-panel
    *ngIf="selectedItem"
    [item]="selectedItem"
    [showActions]="true"
    [showDropControls]="true"
    (close)="closeItemDetails()"
    (equipItem)="equipItem($event)"
    (unequipItem)="unequipItem($event)"
    (useItem)="useItem($event)"
    (removeItem)="removeItem($event.instanceId, $event.quantity)"
    (removeAllItems)="removeAllItems($event)">
  </app-item-details-panel>

  <!-- Inventory Stats (at bottom) -->
  <div class="inventory-stats-container">
    <div class="inventory-stats">
      <div class="stat-item">
        <span class="stat-icon">‚öñÔ∏è</span>
        <div class="stat-content">
          <span class="stat-label">Carrying Capacity</span>
          <span class="stat-value"
                [class.weight-normal]="getWeightPercent() < 80"
                [class.weight-warning]="getWeightPercent() >= 80 && getWeightPercent() < 95"
                [class.weight-critical]="getWeightPercent() >= 95">
            {{ inventoryService.currentWeight().toFixed(1) }} / {{ inventoryService.carryingCapacity().toFixed(1) }} kg
          </span>
        </div>
      </div>
      <div class="stat-item">
        <span class="stat-icon">üì¶</span>
        <div class="stat-content">
          <span class="stat-label">Item Count</span>
          <span class="stat-value">{{ inventoryService.inventorySize() }}</span>
        </div>
      </div>
      <div class="stat-item gold-stat-item">
        <!-- Floating Gold Notifications -->
        <div class="floating-gold-container">
          @for (goldNotif of floatingGold(); track goldNotif.id) {
            <div class="floating-gold">
              +{{ goldNotif.amount }}g
            </div>
          }
        </div>

        <span class="stat-icon">üí∞</span>
        <div class="stat-content">
          <span class="stat-label">Gold</span>
          <span class="stat-value text-gold-400">{{ inventoryService.gold() }} g</span>
        </div>
      </div>
    </div>
  </div>

</div>
