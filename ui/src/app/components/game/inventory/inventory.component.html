<div class="inventory-container">
  <!-- Header -->
  <div class="inventory-header">
    <h2 class="text-2xl font-bold text-gold-400">Inventory</h2>
  </div>

  <!-- Category Filter -->
  <div class="category-filter">
    <button
      *ngFor="let category of categories"
      [class.active]="selectedCategory === category.value"
      (click)="selectedCategory = category.value"
      class="category-btn">
      {{ category.shortLabel }}
    </button>
  </div>

  <!-- Inventory Grid -->
  <div class="inventory-grid">
    <div
      *ngFor="let item of getFilteredInventory()"
      class="inventory-item"
      [class]="getRarityClass(item.definition.rarity)"
      [class.equipped]="item.equipped"
      [draggable]="item.definition.category === 'equipment'"
      (click)="selectItem(item)"
      (dragstart)="onItemDragStart($event, item)"
      (dragend)="onItemDragEnd($event)">
      <div class="item-icon">
        <!-- Placeholder for item icon -->
        <span class="item-tier">T{{ item.definition.properties.tier }}</span>
      </div>
      <div class="item-info">
        <div class="item-name" [class]="inventoryService.getRarityColor(item.definition.rarity)">
          {{ item.definition.name }}
        </div>
        <div class="item-quantity" *ngIf="item.quantity > 1">x{{ item.quantity }}</div>
        <!-- Trait indicators inline -->
        <div class="item-traits-inline" *ngIf="item.traits && item.traits.length > 0">
          <span class="trait-badge" *ngFor="let trait of item.traits">
            {{ trait.charAt(0).toUpperCase() }}
          </span>
        </div>
      </div>
    </div>

    <!-- Empty slots -->
    <div *ngIf="getFilteredInventory().length === 0" class="empty-message">
      <p>No items in this category</p>
    </div>
  </div>

  <!-- Item Details Panel -->
  <div
    class="item-details-panel"
    *ngIf="selectedItem"
    #detailsPanel
    [style.left]="panelLeft"
    [style.top]="panelTop"
    [style.transform]="panelTransform"
    (mousedown)="onDragStart($event, detailsPanel)">
    <div class="details-header">
      <h3 [class]="inventoryService.getRarityColor(selectedItem.definition.rarity)">
        {{ selectedItem.definition.name }}
      </h3>
      <button (click)="closeItemDetails()" class="close-btn close-button">‚úï</button>
    </div>

    <div class="details-content">
      <!-- Basic Info -->
      <div class="detail-section">
        <p class="item-description">{{ selectedItem.definition.description }}</p>
        <div class="detail-row">
          <span class="label">Category:</span>
          <span>{{ selectedItem.definition.category }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Rarity:</span>
          <span [class]="inventoryService.getRarityColor(selectedItem.definition.rarity)">
            {{ selectedItem.definition.rarity }}
          </span>
        </div>
        <div class="detail-row">
          <span class="label">Quantity:</span>
          <span>{{ selectedItem.quantity }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Weight:</span>
          <span>{{ selectedItem.definition.properties.weight }} kg</span>
        </div>
        <div class="detail-row">
          <span class="label">Value:</span>
          <span class="text-gold-400">{{ selectedItem.vendorPrice }}g each</span>
        </div>
      </div>

      <!-- Qualities -->
      <div class="detail-section" *ngIf="getQualityKeys(selectedItem.qualityDetails).length > 0">
        <h4 class="section-title">Qualities</h4>
        <div class="quality-list">
          <div *ngFor="let qualityId of getQualityKeys(selectedItem.qualityDetails)" class="quality-item">
            <span class="quality-name">{{ selectedItem.qualityDetails[qualityId].name }}:</span>
            <span [class]="inventoryService.getQualityColor(selectedItem.qualityDetails[qualityId].value)">
              {{ inventoryService.formatQuality(selectedItem.qualityDetails[qualityId].value) }}
            </span>
          </div>
        </div>
      </div>

      <!-- Traits -->
      <div class="detail-section" *ngIf="selectedItem.traitDetails && selectedItem.traitDetails.length > 0">
        <h4 class="section-title">Traits</h4>
        <div class="trait-list">
          <div *ngFor="let trait of selectedItem.traitDetails" class="trait-item">
            <span [class]="inventoryService.getRarityColor(trait.rarity)" class="trait-name">
              {{ trait.name }}
            </span>
            <p class="trait-description">{{ trait.description }}</p>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="detail-actions">
        <button class="btn-primary" *ngIf="selectedItem.definition.category === 'consumable'">
          Use
        </button>
        <button class="btn-primary" *ngIf="selectedItem.definition.category === 'equipment' && !selectedItem.equipped">
          Equip
        </button>
        <button class="btn-secondary" *ngIf="selectedItem.definition.category === 'equipment' && selectedItem.equipped">
          Unequip
        </button>
        <button class="btn-danger" (click)="removeItem(selectedItem.instanceId)">
          Drop
        </button>
      </div>
    </div>
  </div>

  <!-- Inventory Stats (at bottom) -->
  <div class="inventory-stats-container">
    <div class="inventory-stats">
      <div class="stat-item">
        <span class="stat-icon">üì¶</span>
        <div class="stat-content">
          <span class="stat-label">Capacity</span>
          <span class="stat-value">{{ inventoryService.inventorySize() }} / {{ inventoryService.inventoryCapacity() }}</span>
        </div>
      </div>
      <div class="stat-item">
        <span class="stat-icon">‚öñÔ∏è</span>
        <div class="stat-content">
          <span class="stat-label">Weight</span>
          <span class="stat-value">{{ getTotalWeight() }} kg</span>
        </div>
      </div>
      <div class="stat-item">
        <span class="stat-icon">üí∞</span>
        <div class="stat-content">
          <span class="stat-label">Value</span>
          <span class="stat-value text-gold-400">{{ inventoryService.inventoryValue() }}g</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Dev Tools (remove in production) -->
  <div class="dev-tools" *ngIf="true">
    <h4>Dev Tools</h4>
    <div class="dev-buttons">
      <button (click)="addTestItem('oak_log')" class="dev-btn">Add Oak Log</button>
      <button (click)="addTestItem('willow_log')" class="dev-btn">Add Willow Log</button>
      <button (click)="addTestItem('copper_ore')" class="dev-btn">Add Copper Ore</button>
      <button (click)="addTestItem('trout')" class="dev-btn">Add Trout</button>
      <button (click)="addTestItem('copper_sword')" class="dev-btn">Add Copper Sword</button>
      <button (click)="dropAllItems()" class="dev-btn dev-btn-danger">Drop All Items</button>
    </div>
  </div>
</div>
