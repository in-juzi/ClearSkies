<div class="recipe-list-container">
  <div class="header-row">
    <h2>{{ skill | titlecase }} Recipes</h2>
    @if (!loading) {
      <span class="recipe-count">{{ filteredRecipes().length }} recipe{{ filteredRecipes().length !== 1 ? 's' : '' }}</span>
    }
  </div>

  <!-- Filters -->
  <div class="recipe-filters">
    <div class="filter-row">
      <input
        type="text"
        class="search-input"
        placeholder="Search recipes..."
        [value]="searchQuery()"
        (input)="searchQuery.set($any($event.target).value)"
      />
    </div>

    <div class="filter-row">
      <label class="filter-checkbox">
        <input
          type="checkbox"
          [checked]="showCraftableOnly()"
          (change)="showCraftableOnly.set(!showCraftableOnly())"
        />
        <span>Show craftable only</span>
      </label>

      <div class="filter-sort">
        <label>Sort by:</label>
        <select
          class="sort-select"
          [value]="sortBy()"
          (change)="sortBy.set($any($event.target).value)"
        >
          <option value="level">Level</option>
          <option value="name">Name</option>
          <option value="xp">XP Reward</option>
        </select>
      </div>

      @if (hasActiveFilters()) {
        <button class="btn-clear-filters" (click)="clearFilters()">
          Clear Filters
        </button>
      }
    </div>
  </div>

  @if (loading) {
    <div class="loading">Loading recipes...</div>
  } @else if (filteredRecipes().length === 0) {
    <div class="empty-message">
      @if (searchQuery() || showCraftableOnly()) {
        No recipes match your filters
      } @else {
        No recipes available for {{ skill }}
      }
    </div>
  } @else {
    <div class="recipe-list">
      @for (recipe of filteredRecipes(); track recipe.recipeId) {
        <div class="recipe-card"
             (click)="selectRecipe(recipe)"
             [class.can-craft]="!isRecipeLocked(recipe) && canCraft(recipe).canCraft"
             [class.cannot-craft]="!isRecipeLocked(recipe) && !canCraft(recipe).canCraft"
             [class.locked]="isRecipeLocked(recipe)"
             [title]="isRecipeLocked(recipe) ? getUnlockHint(recipe) : ''">
          <div class="recipe-header">
            <div class="recipe-name">
              @if (isRecipeLocked(recipe)) {
                <span class="lock-icon">ðŸ”’</span>
              }
              {{ recipe.name }}
            </div>
            <div class="recipe-level">Lvl {{ recipe.requiredLevel }}</div>
          </div>
          <div class="recipe-description">{{ recipe.description }}</div>
          @if (isRecipeLocked(recipe)) {
            <div class="unlock-hint">{{ getUnlockHint(recipe) }}</div>
          }
          <div class="recipe-ingredients">
            @for (ingredient of recipe.ingredients; track getIngredientLookupKey(ingredient)) {
              <span class="ingredient"
                    [class.has-enough]="hasEnoughIngredientByLookupKey(getIngredientLookupKey(ingredient), ingredient, ingredient.quantity)"
                    [class.not-enough]="!hasEnoughIngredientByLookupKey(getIngredientLookupKey(ingredient), ingredient, ingredient.quantity)">
                {{ getIngredientLabel(ingredient) }} ({{ getIngredientDisplayByLookupKey(getIngredientLookupKey(ingredient), ingredient, ingredient.quantity) }})
              </span>
            }
          </div>
        </div>
      }
    </div>
  }
</div>
