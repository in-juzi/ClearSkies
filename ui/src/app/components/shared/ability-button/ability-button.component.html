<button
  [class]="buttonClasses()"
  [disabled]="!canUse()"
  (click)="handleClick($event)"
  (mouseenter)="handleHover()"
  type="button">

  <!-- Ability Icon -->
  <div class="ability-icon-container">
    @if (ability().icon) {
      <app-icon
        [path]="ability().icon!.path"
        [material]="ability().icon!.material"
        [autoSize]="true"
        class="ability-icon">
      </app-icon>
    } @else {
      <div class="ability-icon-placeholder">
        <span class="ability-icon-text">{{ ability().name.charAt(0) }}</span>
      </div>
    }

    <!-- Cooldown Overlay -->
    @if (isOnCooldown() && showCooldown()) {
      <div class="cooldown-overlay" [style.height.%]="cooldownPercent()">
        <div class="cooldown-counter">{{ cooldownRemaining() }}</div>
      </div>
    }
  </div>

  <!-- Ability Name (for larger sizes) -->
  @if (size() === 'large') {
    <div class="ability-name">{{ ability().name }}</div>
  }

  <!-- Resource Cost Badge -->
  @if (showCost() && (ability().manaCost ?? 0) > 0) {
    <div class="ability-cost"
         [class.cost-insufficient]="insufficientResource()">
      {{ ability().manaCost }}
    </div>
  }

  <!-- Tooltip -->
  @if (showTooltip()) {
    <div class="ability-tooltip">
      <div class="tooltip-header">
        <div class="tooltip-name">{{ ability().name }}</div>
        <div class="tooltip-badges">
          @if (abilityTypeLabel()) {
            <div class="tooltip-type" [class]="'tooltip-type-' + ability().type">
              {{ abilityTypeLabel() }}
            </div>
          }
          @if (targetTypeLabel()) {
            <div class="tooltip-target">{{ targetTypeLabel() }}</div>
          }
        </div>
      </div>

      <div class="tooltip-description">
        {{ ability().description }}
      </div>

      <!-- Effects Section -->
      @if (damageText() || healingText() || buffText()) {
        <div class="tooltip-effects">
          <div class="section-label">Effects</div>
          @if (damageText()) {
            <div class="effect-item effect-damage">
              <span class="effect-icon">‚öîÔ∏è</span>
              <span class="effect-text">{{ damageText() }}</span>
            </div>
          }
          @if (healingText()) {
            <div class="effect-item effect-heal">
              <span class="effect-icon">üíö</span>
              <span class="effect-text">{{ healingText() }}</span>
            </div>
          }
          @if (buffText()) {
            <div class="effect-item effect-buff">
              <span class="effect-icon">‚ú®</span>
              <span class="effect-text">{{ buffText() }}</span>
            </div>
          }
          @if (ability().effects?.critChanceBonus) {
            <div class="effect-item effect-crit">
              <span class="effect-icon">üí•</span>
              <span class="effect-text">+{{ ability().effects!.critChanceBonus }}% critical chance</span>
            </div>
          }
        </div>
      }

      <!-- Requirements Section -->
      @if (weaponRequirementsText() || skillRequirementText()) {
        <div class="tooltip-requirements">
          <div class="section-label">Requirements</div>
          @if (weaponRequirementsText()) {
            <div class="requirement-item">
              <span class="requirement-icon">üó°Ô∏è</span>
              <span class="requirement-text">{{ weaponRequirementsText() }}</span>
            </div>
          }
          @if (skillRequirementText()) {
            <div class="requirement-item">
              <span class="requirement-icon">üìä</span>
              <span class="requirement-text">{{ skillRequirementText() }}</span>
            </div>
          }
        </div>
      }

      <!-- Stats Section -->
      <div class="tooltip-stats">
        @if ((ability().manaCost ?? 0) > 0) {
          <div class="tooltip-stat">
            <span class="stat-label">Cost:</span>
            <span class="stat-value">{{ ability().manaCost }} {{ resourceLabel() }}</span>
          </div>
        }

        @if ((ability().cooldown ?? 0) > 0) {
          <div class="tooltip-stat">
            <span class="stat-label">Cooldown:</span>
            <span class="stat-value">{{ ability().cooldown }} turns</span>
          </div>
        }

        @if (ability().powerMultiplier && ability().powerMultiplier !== 1) {
          <div class="tooltip-stat">
            <span class="stat-label">Power:</span>
            <span class="stat-value">{{ ability().powerMultiplier }}x</span>
          </div>
        }
      </div>

      <!-- Disabled reason -->
      @if (!canUse() && disabledReasonText()) {
        <div class="tooltip-disabled-reason">
          {{ disabledReasonText() }}
        </div>
      }
    </div>
  }
</button>
