<div class="recipes-container">
  <!-- Recipe List Sidebar -->
  <aside class="recipe-list-sidebar">
    <div class="sidebar-header">
      <h3>Recipes</h3>
      <span class="recipe-count">{{ filteredRecipes().length }} / {{ allRecipes.length }}</span>
    </div>

    <!-- Search -->
    <div class="search-box">
      <span class="material-symbols-outlined">search</span>
      <input
        type="text"
        placeholder="Search recipes..."
        [ngModel]="searchTerm()"
        (ngModelChange)="searchTerm.set($event); applyFilters()"
      />
    </div>

    <!-- Filters -->
    <div class="filters">
      <div class="filter-group">
        <label>Skill</label>
        <select
          [ngModel]="filterSkill()"
          (ngModelChange)="filterSkill.set($event); applyFilters()"
        >
          <option value="all">All Skills</option>
          @for (skill of craftingSkills; track skill) {
            <option [value]="skill">{{ getSkillDisplayName(skill) }}</option>
          }
        </select>
      </div>

      <div class="filter-group">
        <label>Sort By</label>
        <select
          [ngModel]="sortBy()"
          (ngModelChange)="sortBy.set($event); applyFilters()"
        >
          <option value="name">Name</option>
          <option value="skill">Skill</option>
          <option value="level">Required Level</option>
          <option value="duration">Duration</option>
          <option value="xp">Experience</option>
        </select>
      </div>
    </div>

    <!-- Recipe List -->
    <div class="recipe-list">
      @for (recipe of filteredRecipes(); track recipe.recipeId) {
        <div
          class="recipe-list-item"
          [class.selected]="selectedRecipe()?.recipeId === recipe.recipeId"
          (click)="selectRecipe(recipe)"
        >
          <div class="recipe-info">
            <span class="recipe-name">{{ recipe.name }}</span>
            <span class="recipe-id">{{ recipe.recipeId }}</span>
          </div>
          <div class="recipe-stats-preview">
            <span class="stat-badge skill" [style.background-color]="getSkillColor(recipe.skill) + '33'" [style.color]="getSkillColor(recipe.skill)" [style.border-color]="getSkillColor(recipe.skill)">
              {{ getSkillDisplayName(recipe.skill) }}
            </span>
            <span class="stat-badge level">Lvl {{ recipe.requiredLevel }}</span>
            <span class="stat-badge duration">{{ recipe.duration }}s</span>
          </div>
        </div>
      } @empty {
        <div class="empty-state">
          <span class="material-symbols-outlined">menu_book</span>
          <p>No recipes found</p>
        </div>
      }
    </div>
  </aside>

  <!-- Recipe Detail Panel -->
  <main class="recipe-detail-panel">
    @if (selectedRecipe(); as recipe) {
      <div class="detail-content">
        <!-- Header -->
        <div class="detail-header">
          <div class="header-info">
            <h2>{{ recipe.name }}</h2>
            <code class="recipe-id-display">{{ recipe.recipeId }}</code>
          </div>
        </div>

        <!-- Basic Info Section -->
        <section class="detail-section">
          <h3>Basic Information</h3>
          <div class="info-grid">
            <div class="info-item">
              <label>Name</label>
              <span>{{ recipe.name }}</span>
            </div>
            <div class="info-item">
              <label>Recipe ID</label>
              <span>{{ recipe.recipeId }}</span>
            </div>
            <div class="info-item">
              <label>Skill</label>
              <span class="skill-badge" [style.background-color]="getSkillColor(recipe.skill) + '33'" [style.color]="getSkillColor(recipe.skill)" [style.border-color]="getSkillColor(recipe.skill)">
                {{ getSkillDisplayName(recipe.skill) }}
              </span>
            </div>
            <div class="info-item">
              <label>Required Level</label>
              <span class="stat-value">Level {{ recipe.requiredLevel }}</span>
            </div>
            <div class="info-item full-width">
              <label>Description</label>
              <span>{{ recipe.description }}</span>
            </div>
          </div>
        </section>

        <!-- Crafting Stats Section -->
        <section class="detail-section">
          <h3>Crafting Stats</h3>
          <div class="info-grid">
            <div class="info-item">
              <label>Duration</label>
              <span class="stat-value">{{ recipe.duration }} seconds</span>
            </div>
            <div class="info-item">
              <label>Experience</label>
              <span class="stat-value">{{ recipe.experience }} XP</span>
            </div>
          </div>
        </section>

        <!-- Ingredients Section -->
        <section class="detail-section">
          <h3>Ingredients</h3>
          <div class="ingredients-list">
            @for (ingredient of recipe.ingredients; track $index) {
              <div class="ingredient-item">
                @if (ingredient.itemId) {
                  <span class="ingredient-icon">ðŸ“¦</span>
                  <div class="ingredient-info">
                    <span class="ingredient-name">{{ ingredient.itemId }}</span>
                    <span class="ingredient-type">Specific Item</span>
                  </div>
                } @else if (ingredient.subcategory) {
                  <span class="ingredient-icon">ðŸ”€</span>
                  <div class="ingredient-info">
                    <span class="ingredient-name">Any {{ ingredient.subcategory }}</span>
                    <span class="ingredient-type">Subcategory Match</span>
                  </div>
                }
                <span class="ingredient-quantity">x{{ ingredient.quantity }}</span>
              </div>
            }
          </div>
        </section>

        <!-- Outputs Section -->
        <section class="detail-section">
          <h3>Outputs</h3>
          <div class="outputs-list">
            @for (output of recipe.outputs; track $index) {
              <div class="output-item">
                <span class="output-icon">âœ¨</span>
                <div class="output-info">
                  <span class="output-name">{{ output.itemId }}</span>
                  <span class="output-modifier">Quality: {{ capitalizeFirst(output.qualityModifier) }}</span>
                </div>
                <span class="output-quantity">x{{ output.quantity }}</span>
              </div>
            }
          </div>
        </section>

        <!-- Unlock Conditions Section -->
        @if (hasUnlockConditions(recipe)) {
          <section class="detail-section">
            <h3>Unlock Conditions</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>Discovered by Default</label>
                <span [class.success]="isDiscoveredByDefault(recipe)" [class.error]="!isDiscoveredByDefault(recipe)">
                  {{ isDiscoveredByDefault(recipe) ? 'Yes' : 'No' }}
                </span>
              </div>
              @if (recipe.unlockConditions?.requiredRecipes; as requiredRecipes) {
                @if (requiredRecipes.length > 0) {
                  <div class="info-item full-width">
                    <label>Required Recipes</label>
                    <div class="required-list">
                      @for (reqRecipe of requiredRecipes; track reqRecipe) {
                        <code class="required-item">{{ reqRecipe }}</code>
                      }
                    </div>
                  </div>
                }
              }
              @if (recipe.unlockConditions?.requiredItems; as requiredItems) {
                @if (requiredItems.length > 0) {
                  <div class="info-item full-width">
                    <label>Required Items</label>
                    <div class="required-list">
                      @for (reqItem of requiredItems; track reqItem) {
                        <code class="required-item">{{ reqItem }}</code>
                      }
                    </div>
                  </div>
                }
              }
              @if (recipe.unlockConditions?.questRequired) {
                <div class="info-item full-width">
                  <label>Required Quest</label>
                  <code>{{ recipe.unlockConditions?.questRequired }}</code>
                </div>
              }
            </div>
          </section>
        }
      </div>
    } @else {
      <div class="empty-state-detail">
        <span class="material-symbols-outlined">arrow_back</span>
        <h3>No Recipe Selected</h3>
        <p>Select a recipe from the list to view its details</p>
      </div>
    }
  </main>
</div>
